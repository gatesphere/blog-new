<!DOCTYPE html><html><head><meta charset="utf-8"/><link href="http://feeds.feedburner.com/suspended-chord/blog" rel="alternate" title="a-&gt;ab" type="application/rss+xml"/><link href="https://plus.google.com/114523146530319290209/posts" rel="author"/><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><link href="/static/assets/packed.css" media="all" rel="stylesheet" type="text/css"/><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript">
    </script><title>A Simplistic Introduction to Diffie-Hellman Key Exchange | a-&gt;ab</title></head><body><div class="container"><header><h1>a→ab</h1><h2>computation, game design, and experimentation</h2><br/> <a href="/">front page</a> | <a href="/about">about</a> | <a href="/archives">archives</a> | <a href="/code-dump">code dump</a> | <a href="/csmm">c.s. for mere mortals</a> | <a href="/tags">tags</a> | <span class="rss"><a href="http://feeds.feedburner.com/suspended-chord/blog">rss feed</a></span></header><section><div class="column"><article class="post"><header><h1>A Simplistic Introduction to Diffie-Hellman Key Exchange</h1><span class="date">October 4, 2012</span><br/> <span class="tags">tags: <a href="/tag/encryption/">encryption</a>, <a href="/tag/Diffie-Hellman/">Diffie-Hellman</a>, <a href="/tag/key/">key</a>, <a href="/tag/xor/">xor</a>, <a href="/tag/shared%20secret/">shared secret</a>, <a href="/tag/code-dump/">code-dump</a></span></header><section class="content"><p>So, recently, I've been getting into encryption. In that vein, I thought I'd give a quick overview of two topics: simple XOR encryption, and Diffie-Hellman key exchange.</p><h2>XOR encryption</h2><p>The first topic is almost mindnumbingly simple, but it is a simple, cheap, easy to afford encryption algorithm which has several nice features: it's symmetric, composable, and stupid fast.</p><p>So, for XOR encryption to work, you need two things: a payload (the 'cleartext') and an encryption key. The algorithm takes the key and uses it to modify the payload, creating what is known as the 'cyphertext'.<br/> Both the key and payload are typically strings, but anything that can be converted to binary numbers will work. To make things simple, I'm going to use numbers in my examples that follow, instead of strings, so as to avoid encoding concerns, which are really something that shouldn't be worried about when looking at encryption concepts, as they're more of an implementation detail.</p><p>Alright, so let's start off with an example. Say that I want to encrypt the payload '117' with the encryption key '18'. These are arbitrary numbers chosen for the purpose of this example.</p><p>First we start by converting these to binary numbers:</p><div class="codehilite"><pre><span class="n">payload</span> <span class="o">=</span> <span class="mi">117</span> <span class="o">=</span> <span class="mi">0</span><span class="n">b01110101</span>
<span class="n">key</span>     <span class="o">=</span>  <span class="mi">18</span> <span class="o">=</span> <span class="mi">0</span><span class="n">b00010010</span>
</pre></div><p>Then, to create the cypertext, we simply XOR the numbers together:</p><div class="codehilite"><pre>    <span class="mo">01110101</span>          <span class="mi">117</span>  <span class="n">cleartext</span>
<span class="n">XOR</span> <span class="mo">00010010</span>      <span class="n">XOR</span>  <span class="mi">18</span>  <span class="n">key</span>
<span class="o">------------</span>      <span class="o">-------</span>
    <span class="mo">01100111</span>          <span class="mi">103</span>  <span class="n">cyphertext</span>
</pre></div><p>So we've successfully encrypted the payload to the cyphertext. Decryption is simply XORing the cyphertext with the same key. This is why it's a so-called symmetric encryption scheme--encryption and decryption are the exact same operation.</p><div class="codehilite"><pre>    <span class="mo">01100111</span>          <span class="mi">103</span>  <span class="n">cyphertext</span>
<span class="n">XOR</span> <span class="mo">00010010</span>      <span class="n">XOR</span>  <span class="mi">18</span>  <span class="n">key</span>
<span class="o">------------</span>      <span class="o">-------</span>
    <span class="mo">01110101</span>          <span class="mi">117</span>  <span class="n">cleartext</span>
</pre></div><p>What does it mean then, that this algorithm is composable? Well, what would happen if I were to encrypt the data with one key, and then a second, different key? Would it matter which order I applied the decryption? Composable encryption algorithms work regardless of the order of decryption. That is, the following works:</p><div class="codehilite"><pre>  <span class="n">cleartext</span>  <span class="mi">117</span>  <span class="mo">01110101</span>
       <span class="n">key1</span>   <span class="mi">18</span>  <span class="mo">00010010</span>
<span class="o">--------------------------</span>
<span class="n">cyphertext1</span>  <span class="mi">103</span>  <span class="mo">01100111</span>
       <span class="n">key2</span>  <span class="mi">201</span>  <span class="mi">11001001</span>
<span class="o">--------------------------</span>
<span class="n">cyphertext2</span>  <span class="mi">174</span>  <span class="mi">10101110</span>

<span class="n">Decrypt</span> <span class="n">order</span><span class="o">:</span> <span class="n">key2</span><span class="p">,</span> <span class="n">key1</span><span class="o">:</span>
<span class="n">cyphertext2</span>  <span class="mi">174</span>  <span class="mi">10101110</span>
       <span class="n">key2</span>  <span class="mi">201</span>  <span class="mi">11001001</span>
<span class="o">--------------------------</span>
 <span class="n">cleartext1</span>  <span class="mi">103</span>  <span class="mo">01100111</span>
       <span class="n">key1</span>   <span class="mi">18</span>  <span class="mo">00010010</span>
<span class="o">--------------------------</span>
  <span class="n">cleartext</span>  <span class="mi">117</span>  <span class="mo">01110101</span>

<span class="n">Decrypt</span> <span class="n">order</span><span class="o">:</span> <span class="n">key1</span><span class="p">,</span> <span class="n">key2</span><span class="o">:</span>
<span class="n">cyphertext2</span>  <span class="mi">174</span>  <span class="mi">10101110</span>
       <span class="n">key1</span>   <span class="mi">18</span>  <span class="mo">00010010</span>
<span class="o">--------------------------</span>
 <span class="n">cleartext1</span>  <span class="mi">188</span>  <span class="mi">10111100</span>
       <span class="n">key2</span>  <span class="mi">201</span>  <span class="mi">11001001</span>
<span class="o">--------------------------</span>
  <span class="n">cleartext</span>  <span class="mi">117</span>  <span class="mo">01110101</span>
</pre></div><p>Cool huh?</p><h2>Key Exchange</h2><p>Now, how do two people get the same key? Surely, one could just tell the other, and trust that they'll keep it secret. But someone could be listening (the walls have ears, you know!). This won't work.</p><p>What does work is something called Diffie-Hellman key exchange. It involves both participants agreeing on a "shared secret", which will become part of the key, as well as each individually choosing a secret number that they won't tell anyone, not even each other. They then do some simple XORing on these and swap. Because XOR is composable, as explained above, both participants will be able to generate the same secret key without ever sharing it with the other, allowing them to communicate freely.</p><p>How does this work though? Here are the steps (don't worry, there's a textual flowchart of this later in the post):</p><ol><li>Both participants agree on a shared secret. Let's use 34.</li><li>Each participant independently chooses a secret key. Let's use 12 and 21.</li><li>Each participant XORs their secret key with the shared secret. This gives us 46 and 55.</li><li>The participants swap these composed keys.</li><li>The participants XOR their private keys with the coposed keys that they just recieved. This gives us 59 and 59.</li><li>They've generated the same key! They can communicate.</li></ol><p>Diagrammed out a bit, here's how it looks:</p><div class="codehilite"><pre><span class="n">Person</span> <span class="mi">1</span>          <span class="n">Person2</span>
      <span class="mi">34</span>  <span class="n">shared</span>  <span class="mi">34</span>
      <span class="mi">12</span>  <span class="n">secret</span>  <span class="mi">21</span>
      <span class="mi">46</span> <span class="n">composed</span> <span class="mi">55</span>
      <span class="mi">55</span>   <span class="n">swap</span>   <span class="mi">46</span>
      <span class="mi">59</span>   <span class="n">key</span><span class="o">!</span>   <span class="mi">59</span>
</pre></div><p>This does not completely prevent man-in-the-middle attacks, but it does a good bit to make it harder for people to find the encryption key.</p><p>Do note, however, that this implementation is highly flawed: Person 1 can glean Person 2's secret key, and vice versa, after the swap! It's a simple matter of XORing by the shared secret. True key exchange mechanisms use stronger encryption schemes that prevent simple means of ascertaining the private keys of other people.</p><h2>Some code</h2><p>As always with these posts, I try to provide some working code to explain what my words can't convey. Here's an example in Io:</p><script src="https://gist.github.com/3835917.js"> </script><p>Enjoy.</p></section><section class="comments"><div id="disqus_thread"></div><script src="http://disqus.com/forums/suschord/embed.js" type="text/javascript"> </script><noscript>&lt;a href="http://suschord.disqus.com/?url=ref"&gt;View the discussion thread.&lt;/a&gt;</noscript><a class="dsq-brlink" href="http://disqus.com">blog comments powered by <span class="logo-disqus">Disqus</span></a></section></article></div></section><footer>a→ab is the blog of Jake Peck, also known as <a href="http://suspended-chord.info/">suspended-chord</a></footer><script type="text/javascript">
var disqus_shortname = 'suschord';
(function () {
  var s = document.createElement('script'); s.async = true;
  s.src = 'http://disqus.com/forums/suschord/count.js';
  (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script></div></body></html>